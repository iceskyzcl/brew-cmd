# VIM keyblinding

> Vim的正确操作方式: 执行、重复、回退。


## 启动Vim
- `vim file1 file2`


## Vim帮助
- `:version`: 显示配置信息
- `:h xx`: 显示xx的帮助
- `<C-]>`: 进入帮助页面中的链接
- `<C-o>`: 返回页面
- `<C-i>`: 前进页面


## 文件命令
- `:wq`: 保存并关闭
- `:q!`: 关闭不保存
- `:e!`: 放弃所有修改重新编辑
- `:e {filePath}`: 打开文件或目录
- `:ls`: 查看缓冲区文件列表
- `:bn`: 切换到缓冲区下一个文件 buffer next
- `:bp`: 切换到缓冲区上一个文件 buffer previous


## 参数列表
- `:args`: 查看参数列表
- `:args {arglist}`: 重置参数列表, {arglist}可用glob通配符
- `:n`: 编辑下一个文件
- `:N`: 编辑上一个文件, 等同于`:prev`
- `:argdo [cmd]`: 在参数列表包含的所有文件中执行命令


## 窗口
每个窗口为一个独立缓冲区。
- `:new`: 在新窗口新建文件
- `:sp {file}`: 水平split窗口
- `:vsp`: 垂直split
- `:close`: 关闭当前窗口
- `:only`: 关闭除当前窗口外的其它窗口
- `<C-w>`: hjkltb切换窗口, w循环切换
- `<C-w>T`: 把当前窗口移到一个新标签页


## 标签页
每个标签页可包含多个窗口。
- `:tabe {file}`: 在新标签页打开文件, 缺省为在新标签页新建文件
- `:tabc`: 关闭当前标签页
- `:tabo`: 关闭除当前窗口外的其它标签页
- `gt`: 切换到下一个标签页
- `gT`: 切换到上一个标签页
- `{N}gt`: 切换到编号{N}的标签页
- `:tabs`: 查看标签页列表
- `:tabdo [cmd]`: 在所有打开的标签页中执行命令


## 滚屏
- `zt`: 当前行置于顶端
- `zb`: 当前行置于底端
- `zz`: 当前行置于中间
- `<C-y>`: 向上滚动一行
- `<C-e>`: 向下滚动一行
- `<C-u>`: 向上滚动半屏
- `<C-d>`: 向下滚动半屏
- `<C-b>`: 向上滚动一屏
- `<C-f>`: 向下滚动一屏


## 移动光标
- `h`: ←
- `j`: ↓
- `k`: ↑
- `l`: →
- `w`: 下一个单词开头, `W`字符串
- `b`: 上一个单词开头, `B`字符串
- `e`: 下一个单词结尾, `E`字符串
- `0`: 行首
- `^`: 行首非空白字符
- `$`: 行尾
- `gg`: 文件开头
- `G`: 文件末行开头
- `:{N}`: 第{N}行开头, 等同于`{N}G`
- `%`: 跳转到匹配括号
- `(`: 上一句句首
- `)`: 下一句句首
- `{`: 上一段段首
- `}`: 下一段段首
- `[[`: 上一个以`{`开头的行首
- `]]`: 下一个以`{`开头的行首
- `H`: 屏幕首行首个非空白字符
- `M`: 屏幕中间行
- `L`: 屏幕末行
- `f{char}`: 当前行向右跳转到字符{char}
- `F{char}`: 当前行向左跳转到字符{char}
- `t{char}`: till当前行向右跳转到字符{char}的前一个字符
- `T{char}`: 当前行向左跳转到字符{char}的后一个字符
  - `;`: 重复跳转命令
  - `,`: 反向重复跳转命令
- `:marks`: 查看标记列表
- `m{a-zA-Z}`: 标记当前行, 小写标记缓冲区可见, 大写标记全局可见
- `'{mark}`: 跳转到标记行首个非空白字符, \`{mark}跳转到设置标记时的光标位置
- `''`: 来回跳转
- `g;`: 返回上一次修改的位置
- `g,`: 前进
- `gi`: 上次插入的位置
- `'.`: 最后一次修改的位置


## 可视模式VISUAL
- `v`: 字符选择
- `V`: 行选择
- `<C-v>`: 列块选择
- `gv`: 重选上次选区

可视模式下:
- `o`: 切换选区活动端


## 插入模式INSERT
- `i`: 当前位置左insert
- `a`: 当前位置右append
- `o`: 当前行后插入新行
- `s`: 删除当前字符并开始插入
- `I`: 行首插入
- `A`: 行尾插入
- `O`: 当前行前插入新行
- `S`: 删除当前行并开始插入

插入模式下:
- `<C-w>`: 删除前一个单词(linux通用)
- `<C-u>`: 删除至行首(linux通用)
- `<C-o>`: 切换到插入-普通模式, 输入命令后自动回到插入模式
- `<C-r>{reg}`: 插入相应寄存器内容
- `<C-r>=`: 使用表达式寄存器做运算


## 寄存器
- `:reg`: 查看寄存器列表
- `"{reg}{cmd}`: 调用{reg}寄存器进行剪切/复制/粘贴
  - `"0{cmd}`: 复制专用寄存器, `y`复制时会同时往`"0`寄存器复制

默认使用无名寄存器 unnamed

引用小写字母寄存器，会覆盖该寄存器的原有内容

引用大写字母寄存器，会将新内容添加到对应小写寄存器后


## 查找
- `*`: 正向查找当前单词
- `#`: 反向查找当前单词
- `/{pattern}/{offset}`: 正向查找{pattern}
- `?{pattern}?{offset}`: 反向查找{pattern}
- `/`: 正向跳转至相同{pattern}的下一处匹配
- `?`: 反向跳转至相同{pattern}的上一处匹配
- `n`: 查找next
- `N`: 查找previous
- `gn`: 进入可视模式并选中下一处匹配
- `gN`: 进入可视模式并选中上一处匹配
- `:noh`: 取消高亮
- 以下字符需转义: `.*[]^%/?~$`

{pattern}正则模式
- `\v`: very magic 模式, 字母数字下划线按本义, 其它字符为特殊字符
- `\V`: very nomagic 模式, 只有反斜杠(`\`)和终止字符(`/`或`?`)为特殊字符

{offset}设置跳转后的光标位置, 默认在匹配的开头
- `e{N}`: 从结尾向左偏移{N}字符, {N}缺省为结尾
- `s{N}`: 从开头向右偏移{N}字符
- `{N}`: 向下偏移{N}行, 负值为向上


## 替换
- `r{char}`: 将当前字符替换为{char}
- `R`: 替换模式, 相当于<Insert>键


## 剪切
- `x`: 剪切当前字符
- `X`: 剪切当前光标左侧的一个字符或当前行


## 粘贴
- `p`: 右侧或下一行粘贴
- `P`: 左侧或上一行粘贴


## 合并下一行
- `J`: 删除当前行换行符


## 转换大小写
- `~`: 当前字符反转大小写


## 重复
- `.`: 重复上一次修改命令
- `{N}命令`: 执行{N}次命令


## 撤销
- `u`: 撤销上一次修改
- `U`: 撤销对整行的修改
- `<C-r>`: 重做


## 操作符
- `d`: 剪切
- `c`: 修改, 即剪切并进入插入模式
- `y`: 复制
- `>`: 增加缩进
- `<`: 减少缩进
- `=`: 自动缩进
- `g~`: 反转大小写
- `gu`: 转换为小写
- `gU`: 转换为大写
- `!`: 使用外部程序过滤选择范围所跨越的行

正常模式下, 操作=操作符+<a href='#motion'>{motion}范围</a>
> 连续调用两次操作符则作用于当前行
- `daw`: 剪切当前单词 delete a word
- `ciw`: 修改当前单词 change a word
- `dd`: 剪切当前行
- `cc`: 修改当前行并保留缩进
- `yy`: 复制当前行
- `>>`: 当前行增加缩进
- `guu`: 当前行转换为小写
- `!!{filter}`: 用外部程序{filter}过滤当前行

`tpope/vim-commentary`注释插件操作符:
> 参见`:h commentary`
- `gc`: 注释
  - `gcc`: 注释当前行
  - `gcap`: 注释当前段落

`tpope/vim-surround`符号对插件操作符:
> 参见`:h surround`, 使用左括号会留一个空格, 使用右括号不留空格
- `ds`: 删除符号对
  - `ds"`: 删除""
  - `dst`: 删除标签对 如<a></a>
- `cs`: 修改符号对
  - `cs"<p>`: 符号对""改为<p></p>
  - `cst<p>`: 标签对改为<p></p>
- `ys`: 添加符号对, `yS`和`ySS`符号对独占一行
  - `yss)`: 当前行前后添加()
  - `ysap{`: 当前段落前后添加{}
> 可视模式下, 操作符`S`对选中内容添加符号对


## <a name='motion'>{motion}范围</a>
- `aw`: 当前单词(含一侧空白) a word
- `iw`: 当前单词(不含前后空白) inner word
- `aW`: 字符串(含一侧空白) a WORD
- `iW`: 字符串(不含前后空白) inner WORD
- `as`: 句子(含一侧空白) a sentence
- `is`: 句子(不含前后空白) inner sentence
- `ap`: 段落(含一个空行) a paragraph
- `ip`: 段落(不含前后空行) inner paragraph
- `a]`: []区块(含) a [] block
- `i]`: []区块(不含) inner [] block
- `at`: 标签块(含) a tag block 如<a></a>
- `it`: 标签块(不含) inner tab block
- `gn`: 下一个搜索匹配
- `gN`: 上一个搜索匹配
- 移动命令: 当前位置到移动后的位置所包含的范围
- 搜索命令: 当前位置到第一个匹配位置前所包含的范围


## 加减运算
- `{N}<C-a>`: 把当前光标或之后的一个数值加上{N}
- `{N}<C-x>`: 把当前光标或之后的一个数值减去{N}


## 命令行模式
- `:[range]d`: delete范围内的行
  - `:{start},{end}d`: 删除第{start}行至第{end}行, 缺省或.当前行, $末行, %所有行
- `:[range]y`: yank范围内的行
- `:[range]j`: join范围内的行
- `:[range]m{address}`: move把范围内的行移动到 {address} 指定的行下
- `:[range]t{address}`: copy把范围内的行复制到 {address} 指定的行下
- `:[range]s/{pattern}/{string}/[flags]`: substitute把{pattern}替换为{string}
  - `:s/old/new/`: 替换当前行的第一个匹配
  - `:s/old/new/g`: 替换当前行的所有匹配
  - `:%s/old/new/`: 替换所有行的第一个匹配
  - `:%s/old/new/gc`: 替换所有行的所有匹配, 逐个确认
  - `:1,9s/^/    /`: 第1行至第9行每行前加四个空格
- `:[range]norm [cmd]`: normal对范围内的所有行执行正常模式{cmd}, 每行光标在行首
  - `:1,9norm i    `: 第1行至第9行每行前加四个空格
  - `:1,9norm @{reg}`: 第1行至第9行每行运行宏{reg}

以下命令[range]缺省为所有行:
- `:[range]g/{pattern}/[cmd]`: global对范围内包含{pattern}的所有行执行{cmd}
- `:[range]v/{pattern}/[cmd]`: vglobal对范围内不包含{pattern}的所有行执行{cmd}

可视模式下选择了范围, 则[range]默认为选区的起始行至结束行`'<,'>`


## shell命令
- `:!{cmd}`: 执行shell命令{cmd}
  - `:!ls`: 执行命令ls
  - `:!python3 %`: 用Python运行当前文件
- `:[range]!{filter}`: 用外部程序`{filter}`过滤范围内的所有行
  - `:%!grep {pattern}`: 用外部程序`grep`过滤所有行
  - `:%!sort -t ',' -k 2`: 用外部程序`sort`对所有行进行排序

在终端环境下, 运行shell更合适的方式是按`<C-z>`挂起Vim
> shell命令`fg`唤醒后台程序, `jobs`查看后台程序
